<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controles Remotos</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
    body { background: #f2f2f2; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; color: #333; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
    .card { background: white; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 10px; text-align: center; }
    .card img { width: 100%; height: 180px; object-fit: contain; transition: transform 0.3s ease; cursor: zoom-in; }
    .card img:hover { transform: scale(1.2); }
    .price { color: #444; font-weight: bold; }
    .counter { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 10px 0; }
    .counter button { padding: 5px 10px; font-size: 16px; cursor: pointer; background: #ddd; border: none; border-radius: 4px; }
    .qty { width: 40px; text-align: center; }
    .add-btn { background-color: #1abc9c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
    .add-btn:hover { background-color: #16a085; }
    .cart { margin-top: 60px; margin-bottom: 60px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding-bottom: 80px; }
    .cart-summary { font-size: 14px; color: #333; margin-top: 10px; }
    .cart-item { margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 10px; position: relative; }
    .cart-title { font-weight: bold; margin-bottom: 10px; font-size: 16px; }
    .cart-thumb { width: 40px; height: 40px; object-fit: contain; margin-right: 8px; vertical-align: middle; border-radius: 5px; }
    .cart button { background-color: #27ae60; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
    .cart button:hover { background-color: #219150; }
    .edit-controls { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
    .edit-controls button { padding: 4px 10px; background: #ddd; border: none; cursor: pointer; font-size: 14px; }
    .edit-controls input { width: 35px; text-align: center; }
    .delete-btn { background: none !important; color: #e74c3c !important; font-weight: bold !important; border: none !important; cursor: pointer !important; font-size: 20px !important; position: absolute !important; top: 0; right: 0; padding: 5px; }
    .delete-btn:hover { color: #c0392b !important; }
    #floatingCartBar { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: #1abc9c; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; font-size: 16px; }
    #floatingCartBar button { background: none; border: none; color: white; font-weight: bold; font-size: 16px; cursor: pointer; }
    #zoomModal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; flex-direction: column; z-index: 2000; }
    #zoomModal img { max-width: 90%; max-height: 80%; border-radius: 10px; }
    #zoomModal button { margin-top: 20px; background-color: white; color: black; border: none; padding: 8px 16px; font-size: 16px; border-radius: 8px; cursor: pointer; }
    #zoomModal button:hover { background-color: #ddd; }
  </style>
</head>
<body>

<h1>CONTROLES REMOTOS</h1>
<input type="text" id="buscador" placeholder="Buscar modelo..." oninput="filtrarProductos()" style="display:block; margin: 0 auto 20px; padding: 10px; width: 90%; max-width: 400px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;">

<div class="grid" id="productGrid"></div>

<div class="cart" id="cart">
  <div class="cart-title">PEDIDO</div>
  <div class="cart-summary" id="cartSummary"></div>
  <p><strong>Cantidad total:</strong> <span id="itemCount">0</span></p>
  <p><strong>Total:</strong> <span id="totalPrice">$0</span></p>
  <button onclick="sendOrder()">Enviar pedido por WhatsApp</button>
  <button onclick="vaciarCarrito()" style="background-color: #e74c3c; margin-left: 10px;">üóëÔ∏è Vaciar carrito</button>
</div>

<div id="floatingCartBar">
  <button onclick="scrollToCart()">üõí Ver carrito</button>
  <span id="floatingTotal">TOTAL: $0</span>
</div>

<div id="zoomModal">
  <img id="zoomImg" src="" alt="Zoom">
  <button onclick="cerrarZoom()">‚úñ Cerrar</button>
</div>

<script>
const products = [];
const sheetURL = "https://opensheet.elk.sh/1syQDKQOns9acBo3J-2e6KD7RuCoc7o2Cyzu3R80cnFw/Hoja1";
const cart = {};
const productGrid = document.getElementById("productGrid");
const itemCount = document.getElementById("itemCount");
const totalPrice = document.getElementById("totalPrice");
const cartSummary = document.getElementById("cartSummary");
const floatingBar = document.getElementById("floatingCartBar");
const floatingTotal = document.getElementById("floatingTotal");
const savedCart = localStorage.getItem("carritoControles");
if (savedCart) {
  Object.assign(cart, JSON.parse(savedCart));
  updateCart();
}

fetch(sheetURL)
  .then(res => res.json())
  .then(data => {
    products.push(...data.map((p, i) => ({
      id: i + 1,
      name: p.name,
      price: parseFloat(p.price),
      img: p.img
    })));
    filtrarProductos();
  });
  
 function cargarProductos() {
  fetch("https://opensheet.elk.sh/1syQDKQOns9acBo3J-2e6KD7RuCoc7o2Cyzu3R80cnFw/Hoja1")
    .then(res => res.json())
    .then(data => {
      products.length = 0; // limpia el array actual
      products.push(...data.map((p, i) => ({
        id: i + 1,
        name: p.name,
        price: parseFloat(p.price),
        img: p.img
      })));
      filtrarProductos(); // actualiza la grilla
    });
}

cargarProductos(); // carga inicial
setInterval(cargarProductos, 60000); // recarga cada 60 segundos


function formatearPrecio(num) {
  return "$" + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}
function abrirZoom(src) {
  document.getElementById("zoomImg").src = src;
  document.getElementById("zoomModal").style.display = "flex";
}
function cerrarZoom() {
  document.getElementById("zoomModal").style.display = "none";
}
function deleteProduct(name) {
  delete cart[name];
  updateCart();
}
function addToCart(id, qty) {
  const product = products.find(p => p.id === id);
  if (cart[product.name]) {
    cart[product.name].qty += qty;
  } else {
    cart[product.name] = { ...product, qty };
  }
  updateCart();
}
function updateCart() {
  let totalItems = 0;
  let totalCost = 0;
  cartSummary.innerHTML = "";
  for (const key in cart) {
    const item = cart[key];
    const subtotal = item.qty * item.price;
    totalItems += item.qty;
    totalCost += subtotal;
    const itemDiv = document.createElement("div");
    itemDiv.className = "cart-item";
    itemDiv.innerHTML = `
      <img src="${item.img}" class="cart-thumb">
      <strong>${item.name}</strong> | ${formatearPrecio(item.price)} c/u | x${item.qty} | Total: ${formatearPrecio(subtotal)}
      <div class="edit-controls">
        <button onclick="editQty('${key}', -1)">-</button>
        <input type="number" min="1" value="${item.qty}" onchange="setQty('${key}', this.value)">
        <button onclick="editQty('${key}', 1)">+</button>
      </div>
      <button class="delete-btn" onclick="deleteProduct('${key}')" title="Eliminar">√ó</button>
    `;
    cartSummary.appendChild(itemDiv);
  }
  itemCount.textContent = totalItems;
  totalPrice.textContent = formatearPrecio(totalCost);
  floatingBar.style.display = totalItems > 0 ? "flex" : "none";
  floatingTotal.textContent = `TOTAL: ${formatearPrecio(totalCost)}`;
  localStorage.setItem("carritoControles", JSON.stringify(cart));
  if (Object.keys(cart).length === 0) localStorage.removeItem("carritoControles");
}
function editQty(name, change) {
  if (cart[name]) {
    cart[name].qty += change;
    if (cart[name].qty < 1) cart[name].qty = 1;
    updateCart();
  }
}
function setQty(name, newQty) {
  const qty = parseInt(newQty);
  if (cart[name] && qty > 0) {
    cart[name].qty = qty;
    updateCart();
  }
}
function scrollToCart() {
  document.getElementById("cart").scrollIntoView({ behavior: "smooth" });
}
function sendOrder() {
  if (Object.keys(cart).length === 0) {
    alert("Tu carrito est√° vac√≠o.");
    return;
  }
  let message = "Hola, quiero hacer un pedido:\nPEDIDO\n";
  for (const key in cart) {
    const item = cart[key];
    const subtotal = item.price * item.qty;
    message += `- ${item.name} | ${formatearPrecio(item.price)} | x${item.qty} | ${formatearPrecio(subtotal)}\n`;
  }
  const total = Object.values(cart).reduce((sum, item) => sum + item.qty * item.price, 0);
  const qty = Object.values(cart).reduce((sum, item) => sum + item.qty, 0);
  message += `\nCantidad total: ${qty}\nTotal: ${formatearPrecio(total)}`;
  const phone = "5493416654727";
  const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
  window.open(url, "_blank");
}
function vaciarCarrito() {
  if (confirm("¬øEst√°s seguro de que quer√©s vaciar el carrito?")) {
    for (const key in cart) {
      delete cart[key];
    }
    localStorage.removeItem("carritoControles");
    updateCart();
  }
}
function filtrarProductos() {
  const texto = document.getElementById("buscador").value.toLowerCase();
  productGrid.innerHTML = "";
  products.forEach(product => {
    if (product.name.toLowerCase().includes(texto)) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${product.img}" alt="${product.name}" onclick="abrirZoom('${product.img}')">
        <h3>${product.name}</h3>
        <p class="price">${formatearPrecio(product.price)}</p>
        <div class="counter">
          <button class="btn-minus">-</button>
          <input type="number" min="1" value="1" class="qty" />
          <button class="btn-plus">+</button>
        </div>
        <button class="add-btn">Agregar</button>
      `;
      const inputQty = card.querySelector('.qty');
      const addBtn = card.querySelector('.add-btn');
      const btnMinus = card.querySelector('.btn-minus');
      const btnPlus = card.querySelector('.btn-plus');
      btnMinus.onclick = () => {
        let current = parseInt(inputQty.value);
        inputQty.value = current > 1 ? current - 1 : 1;
      };
      btnPlus.onclick = () => {
        let current = parseInt(inputQty.value);
        inputQty.value = current + 1;
      };
      addBtn.onclick = () => {
        const qty = parseInt(inputQty.value);
        addToCart(product.id, qty);
        inputQty.value = 1;
      };
      productGrid.appendChild(card);
    }
  });
}
</script>
</body>
</html>
